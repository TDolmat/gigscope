# Caddyfile - Reverse Proxy Configuration for scoper.befreeclub.pro
# Caddy automatically handles HTTPS certificates via Let's Encrypt

# Main domain configuration
scoper.befreeclub.pro {
    # Enable automatic HTTPS
    # Caddy will automatically obtain and renew SSL certificates
    
    # Logging
    log {
        output stdout
        format console
        level INFO
    }

    # Security headers
    header {
        # Enable HSTS (HTTP Strict Transport Security)
        Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
        
        # Prevent clickjacking
        X-Frame-Options "SAMEORIGIN"
        
        # XSS Protection
        X-Content-Type-Options "nosniff"
        
        # Remove server header for security
        -Server
    }

    # Backend API routes
    handle /api/* {
        reverse_proxy backend:5000 {
            # Health check
            health_uri /api/health
            health_interval 30s
            health_timeout 10s
            
            # Headers to pass
            header_up X-Real-IP {remote_host}
            header_up X-Forwarded-For {remote_host}
            header_up X-Forwarded-Proto {scheme}
            header_up Host {host}
        }
    }

    # Frontend - Next.js (default handler for all other routes)
    handle {
        reverse_proxy frontend:3000 {
            # Health check
            health_interval 30s
            health_timeout 10s
            
            # Headers to pass
            header_up X-Real-IP {remote_host}
            header_up X-Forwarded-For {remote_host}
            header_up X-Forwarded-Proto {scheme}
            header_up Host {host}
        }
    }
}

